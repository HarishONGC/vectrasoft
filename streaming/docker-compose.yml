services:
  mediamtx:
    image: bluenviron/mediamtx:latest
    container_name: cctv-mediamtx
    restart: unless-stopped
    ports:
      - "8554:8554"   # RTSP
      - "8888:8888"   # HLS (http://localhost:8888/<path>/index.m3u8)
      - "8889:8889"   # WebRTC HTTP (optional)
      - "8189:8189/udp" # WebRTC ICE/UDP (optional)
    volumes:
      - ./mediamtx.docker.yml:/mediamtx.yml:ro

  # Kesanapalli-01 is H.265 -> transcode to H.264 and publish to MediaMTX.
  ffmpeg-kesanapalli-01:
    image: linuxserver/ffmpeg:latest
    container_name: cctv-ffmpeg-kesanapalli-01
    restart: unless-stopped
    depends_on:
      - mediamtx
    command:
      [
        "-hide_banner",
        "-loglevel",
        "warning",
        "-rtsp_transport",
        "tcp",
        "-i",
        "rtsp://live:WSS4Bosch!@117.236.225.209:554",
        "-an",
        "-c:v",
        "libx264",
        "-preset",
        "veryfast",
        "-tune",
        "zerolatency",
        "-pix_fmt",
        "yuv420p",
        "-g",
        "50",
        "-keyint_min",
        "50",
        "-sc_threshold",
        "0",
        "-f",
        "rtsp",
        "-rtsp_transport",
        "tcp",
        "rtsp://mediamtx:8554/kesanapalli-01"
      ]

  # Kesanapalli-04 is H.265 -> transcode to H.264 and publish to MediaMTX.
  ffmpeg-kesanapalli-04:
    image: linuxserver/ffmpeg:latest
    container_name: cctv-ffmpeg-kesanapalli-04
    restart: unless-stopped
    depends_on:
      - mediamtx
    command:
      [
        "-hide_banner",
        "-loglevel",
        "warning",
        "-rtsp_transport",
        "tcp",
        "-i",
        "rtsp://live:WSS4Bosch!@117.236.225.213:554",
        "-an",
        "-c:v",
        "libx264",
        "-preset",
        "veryfast",
        "-tune",
        "zerolatency",
        "-pix_fmt",
        "yuv420p",
        "-g",
        "50",
        "-keyint_min",
        "50",
        "-sc_threshold",
        "0",
        "-f",
        "rtsp",
        "-rtsp_transport",
        "tcp",
        "rtsp://mediamtx:8554/kesanapalli-04"
      ]
